<div class="page-header">
  <!-- Google Maps -->
  <div align="center" style="width: 100%; margin-bottom: 4em; ; margin-top: 1em;">
    <div id="map" style='width: 60em; height: 42em;'></div>
  </div>

  <script type="text/javascript">
    handler = Gmaps.build('Google');
    handler.buildMap({provider: {}, internal: {id: 'map'}}, function() {
      markers = handler.addMarkers(<%=raw @hash.to_json %>);
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
      handler.getMap().setZoom(7)
    });

  </script>
  <!-- End Google Maps -->


  <h1>Listing stations</h1>
</div>

<div class="table-responsive">
  <table class="table table-striped table-bordered table-hover">
    <thead>
    <tr>
      <th>Name</th>
      <th>Latitude</th>
      <th>Longitude</th>
      <th style="width: 3em;">Today's Weather</th>
      <th>Most Recent Reading</th>
      <th>Flow Rate</th>

      <th></th>
    </tr>
    </thead>
    <tbody>
    <% @stations_paginated.each do |station| %>
        <tr>
          <div dom_id(station)>
            <td><%= link_to station.name, station %></td>
            <td><%= fmt_coord station.latitude.to_f %></td>
            <td><%= fmt_coord station.longitude.to_f %></td>
            <td style="width: 3em;">
              <% if station.forecasts.any? %>
                  <strong>High: </strong> <%= number_with_precision(station.forecasts.first.maxtemp, precision: 2) %> &deg;F<br/>
                  <strong>Low: </strong><%= number_with_precision(station.forecasts.first.mintemp.to_f, precision: 2) %> &deg;F
              <% end %>
            </td>

          <td><%= station.flow_readings.first.date_time.in_time_zone.strftime("%A %e %B %Y,%I:%M:%S %Z") %></td>
          <td><%= format_flow_rate station.flow_readings.first.flow_rate %></td>
          <td>
            <% if station.favorite?(current_user) %>
            <%= button_to 'Unclaim', unclaim_station_path(station) %>
              <% else %>
              <%= button_to 'Claim', claim_station_path(station) %>
          <% end %>
          </td>


        </div>
    <% end %>
    </tbody>
  </table>
</div>

<%= will_paginate @stations_paginated, renderer: BootstrapPagination::Rails %>
